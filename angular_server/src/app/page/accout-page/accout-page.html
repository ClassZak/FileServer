<app-app-header></app-app-header>

<main class="MainContent">
	@if (isLoading) {
		<app-loading-spinner
			[title]="'Загрузка'">
		</app-loading-spinner>
	} @else {
		<div>    
			<h1 class="account-title">Личный кабинет</h1>
			<div class="account-container">
				<div class="account-card">
					<h2>Информация о пользователе</h2>
					<div class="account-info">	
						<p><strong>Email:</strong> {{user?.email}} </p>
						<p><strong>Фамилия:</strong> {{user?.surname}} </p>
						<p><strong>Имя:</strong> {{user?.name}} </p>
						<p><strong>Отчество:</strong> {{user?.patronymic}} </p>
					</div>
					<div class='buttons-row'>
						<button
							(click)="setPasswordModalIsOpen(true)"
							class="logout-button">
							Обновить пароль
						</button>
						<button (click)="handleLogout()" class="logout-button">
							Выйти
						</button>
					</div>
				</div>
			
				@if (isAdmin) {
					<div class='buttons-row'>
						<app-redirection-button 
							[reference]="'/users'" 
							[title]="'Пользователи'"    
							[className]="'blue-button'">
						</app-redirection-button>
						
						<app-redirection-button 
							[reference]="'/groups'" 
							[title]="'Группы'"    
							[className]="'blue-button'">
						</app-redirection-button>
						
						<button (click)="navigateToUsers();" class="green-button">
							Вступить в группу
						</button>
					</div>
				}
				
				@if (!isLoadingGroups) {
					<div>
						<h1>Ваши группы</h1>
						@if (groups && groups.length > 0) {
							<table class="file-table">
								<thead>
									<tr>
										<th>Название</th>
										<th>Число участников</th>
										<th>Почта создателя</th>
										<th>Действия</th>
									</tr>
								</thead>
								<tbody>
									@for (group of groups; track group.name) {
										<tr>
											<td>{{ group.name }}</td>
											<td>{{ group.membersCount }}</td>
											<td>{{ group.creatorEmail }}</td>
											<td>
												<button 
													(click)="navigateToGroup(group.name)"
													class="blue-button">
													Изменить данные
												</button>
											</td>
										</tr>
									}
								</tbody>
							</table>
						} @else {
							<p style="text-align: center; padding: 20px;">
								Группы не найдены
							</p>
						}
					</div>
				}
			</div>
		</div>
	}
</main>

<app-footer></app-footer>